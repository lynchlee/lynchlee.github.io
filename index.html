<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="この世は、强ければ生き、弱ければし。">
<meta property="og:type" content="website">
<meta property="og:title" content="剣の心 の Blog">
<meta property="og:url" content="http://kenshinn.net/index.html">
<meta property="og:site_name" content="剣の心 の Blog">
<meta property="og:description" content="この世は、强ければ生き、弱ければし。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="剣の心 の Blog">
<meta name="twitter:description" content="この世は、强ければ生き、弱ければし。">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"hide"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '剣の心'
    }
  };
</script>

  <title> 剣の心 の Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-hk">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">剣の心 の Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">この世は、强ければ生き、弱ければし。</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-thinks">
          <a href="/thinks" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-diamond"></i> <br />
            
            隨筆
          </a>
        </li>
      
        
        <li class="menu-item menu-item-java">
          <a href="/java" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-fire"></i> <br />
            
            Java
          </a>
        </li>
      
        
        <li class="menu-item menu-item-bigdata">
          <a href="/bigdata" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-database"></i> <br />
            
            大数据
          </a>
        </li>
      
        
        <li class="menu-item menu-item-reading">
          <a href="/reading" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            読书
          </a>
        </li>
      
        
        <li class="menu-item menu-item-taobao_shop">
          <a href="https://shop152117682.taobao.com/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            彫刻時間衣館
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            關於
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/15/Understanding-How-CQL3-Maps-to-Cassandra’s-Internal-Data-Structure-Collections/" itemprop="url">
                  How CQL3 Maps to Cassandra’s Internal Data Structure - Sets, Lists, and Maps
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-15T01:11:27+08:00" content="2016-07-15">
              2016-07-15
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/15/Understanding-How-CQL3-Maps-to-Cassandra’s-Internal-Data-Structure-Collections/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/15/Understanding-How-CQL3-Maps-to-Cassandra’s-Internal-Data-Structure-Collections/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>This is just a quick reference regarding how Cassandra sets, lists, and maps work under the hood:</p>
<h5 id="Maps"><a href="#Maps" class="headerlink" title="Maps"></a>Maps</h5><p>Defining:</p>
<pre><code>cqlsh:test&gt; CREATE TABLE phonelists (
        ... user text PRIMARY KEY,
        ... phoneNumbers map&lt;text,text&gt; );
</code></pre><p>Inserting:</p>
<pre><code>cqlsh:test&gt; INSERT INTO phonelists (user, phonenumbers)
        ... VALUES (&apos;john&apos;,{&apos;patricia&apos;:&apos;555-4326&apos;,&apos;doug&apos;:&apos;555-1579&apos;});
cqlsh:test&gt; INSERT INTO phonelists (user, phonenumbers)
        ... VALUES (&apos;scott&apos;,{&apos;bill&apos;:&apos;555-7382&apos;,&apos;patricia&apos;:&apos;555-4326&apos;, &apos;jane&apos;:&apos;555-8743&apos;});
</code></pre><p>Retrieving:</p>
<pre><code>cqlsh:test&gt; SELECT * FROM phonelists;

 user  | phonenumbers
-------+------------------------------------------------------
 scott | {bill: 555-7382, jane: 555-8743, patricia: 555-4326}
  john |                 {doug: 555-1579, patricia: 555-4326}
</code></pre><p>Updating:</p>
<pre><code>cqlsh:test&gt; UPDATE phonelists
        ... SET phonenumbers = phonenumbers + {&apos;daniel&apos;:&apos;555-0453&apos;}
        ... WHERE user=&apos;john&apos;;
The internal representation:

[default@test] list phonelists;
-------------------
RowKey: scott
=&gt; (column=, value=, timestamp=1374684062860000)
=&gt; (column=phonenumbers:bill, value=&apos;555-7382&apos;, timestamp=1374684062860000)
=&gt; (column=phonenumbers:jane, value=&apos;555-8743&apos;, timestamp=1374684062860000)
=&gt; (column=phonenumbers:patricia, value=&apos;555-4326&apos;, timestamp=1374684062860000)
-------------------
RowKey: john
=&gt; (column=, value=, timestamp=1374683971220000)
=&gt; (column=phonenumbers:doug, value=&apos;555-1579&apos;, timestamp=1374683971220000)
=&gt; (column=phonenumbers:patricia, value=&apos;555-4326&apos;, timestamp=1374683971220000)
Note that the above text components, e.g. ‘doug’ and ‘555-1579′, are returned by cassandra-cli in their hex encoding. I’ve taken the liberty to decode them so that the print out is more understandable. I will do this throughout the post.
</code></pre><h5 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h5><p>Defining:</p>
<pre><code>cqlsh:test&gt; CREATE TABLE friendlists (
        ... user text PRIMARY KEY,
        ... friends list &lt;text&gt;
        ... );
</code></pre><p>Inserting:</p>
<pre><code>cqlsh:test&gt; INSERT INTO friendlists (user, friends)
        ... VALUES (&apos;john&apos;,[&apos;doug&apos;,&apos;patricia&apos;,&apos;scott&apos;]);
cqlsh:test&gt; INSERT INTO friendlists (user, friends)
        ... VALUES (&apos;patricia&apos;, [&apos;john&apos;,&apos;lucifer&apos;]);
</code></pre><p>Retrieving:</p>
<pre><code>cqlsh:test&gt; SELECT * FROM friendlists;

 user     | friends
----------+-------------------------
     john | [doug, patricia, scott]
 patricia |         [john, lucifer]
</code></pre><p>Updating:</p>
<pre><code>cqlsh:test&gt; UPDATE friendlists
        ... SET friends = friends + [&apos;matt&apos;,&apos;eric&apos;]
        ... WHERE user=&apos;john&apos;;
cqlsh:test&gt; UPDATE friendlists
        ... SET friends = friends - [&apos;lucifer&apos;]
        ... WHERE user=&apos;patricia&apos;;
</code></pre><p>The internal representation:</p>
<pre><code>[default@test] list friendlists;
Using default limit of 100
Using default column limit of 100
-------------------
RowKey: john
=&gt; (column=, value=, timestamp=1374687324950000)
=&gt; (column=friends:26017c10f48711e2801fdf9895e5d0f8, value=&apos;doug&apos;, timestamp=1374687206993000)
=&gt; (column=friends:26017c11f48711e2801fdf9895e5d0f8, value=&apos;patricia&apos;, timestamp=1374687206993000)
=&gt; (column=friends:26017c12f48711e2801fdf9895e5d0f8, value=&apos;scott&apos;, timestamp=1374687206993000)
=&gt; (column=friends:6c504b60f48711e2801fdf9895e5d0f8, value=&apos;matt&apos;, timestamp=1374687324950000)
=&gt; (column=friends:6c504b61f48711e2801fdf9895e5d0f8, value=&apos;eric&apos;, timestamp=1374687324950000)
-------------------
RowKey: patricia
=&gt; (column=, value=, timestamp=1374687352290000)
=&gt; (column=friends:3b817b80f48711e2801fdf9895e5d0f8, value=&apos;john&apos;, timestamp=1374687243064000)
</code></pre><p>Here the internal column name is more complicated because a UUID is appended to the name of the CQL field “friend”. This is used to keep track of the order of items in the list.</p>
<p>To be determined: Does a list item delete take more time than a list insert? I suspect so – I don’t see how Cassandra can delete an element in the list without reading in all the elements in the list and then deleting column that has the value indicated in the delete. — UPDATE This is the case.</p>
<h6 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h6><p>Defining:</p>
<pre><code>cqlsh:test&gt; CREATE TABLE friendsets (
        ... user text PRIMARY KEY,
        ... friends set &lt;text&gt;
        ... );
</code></pre><p>Inserting:</p>
<pre><code>cqlsh:test&gt; INSERT INTO friendsets (user, friends)
        ... VALUES (&apos;john&apos;,{&apos;doug&apos;,&apos;patricia&apos;,&apos;scott&apos;});
cqlsh:test&gt; INSERT INTO friendsets (user, friends)
        ... VALUES (&apos;patricia&apos;, {&apos;john&apos;,&apos;lucifer&apos;});
</code></pre><p>Retrieving:</p>
<pre><code>cqlsh:test&gt; SELECT * FROM friendsets;

 user     | friends
----------+-------------------------
     john | {doug, patricia, scott}
 patricia |         {john, lucifer}
</code></pre><p>Updating:</p>
<pre><code>cqlsh:test&gt; UPDATE friendsets
        ... SET friends = friends + {&apos;matt&apos;,&apos;eric&apos;}
        ... WHERE user=&apos;john&apos;;
cqlsh:test&gt; UPDATE friendsets
        ... SET friends = friends - {&apos;lucifer&apos;}
        ... WHERE user=&apos;patricia&apos;;
</code></pre><p>The internal representation:</p>
<pre><code>[default@test] list friendsets;
Using default limit of 100
Using default column limit of 100
-------------------
RowKey: john
=&gt; (column=, value=, timestamp=1374688135443000)
=&gt; (column=friends:&apos;doug&apos;, value=, timestamp=1374688108307000)
=&gt; (column=friends:&apos;eric&apos;, value=, timestamp=1374688135443000)
=&gt; (column=friends:&apos;matt&apos;, value=, timestamp=1374688135443000)
=&gt; (column=friends:&apos;patricia&apos;, value=, timestamp=1374688108307000)
=&gt; (column=friends:&apos;scott&apos;, value=, timestamp=1374688108307000)
-------------------
RowKey: patricia
=&gt; (column=, value=, timestamp=1374688151386000)
=&gt; (column=friends:&apos;john&apos;, value=, timestamp=1374688116595000)
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/12/Cassandra-Query-Patterns-Not-using-the-in-query–for-multiple-partitions/" itemprop="url">
                  Cassandra Query Patterns-Not using the “in” query for multiple partitions.
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-12T17:24:20+08:00" content="2016-07-12">
              2016-07-12
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/12/Cassandra-Query-Patterns-Not-using-the-in-query–for-multiple-partitions/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/12/Cassandra-Query-Patterns-Not-using-the-in-query–for-multiple-partitions/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>So lets say you’re doing you’re best to data model all around one partition. You’ve done your homework and all you queries look like this:</p>
<pre><code>SELECT * FROM my_keyspace.users where id = 1
</code></pre><p>Over time as features are added however, you make some tradeoffs and need to start doing queries across partitions. At first there are only a few queries like this.</p>
<pre><code>SELECT * FROM my_keyspace.users where id in (1,2,3,4)
</code></pre><p>You’re cluster is well tuned so you have no problems, but as time goes on your dataset increases and users are doing bigger searches across more users.</p>
<pre><code>SELECT * FROM my_keyspace.users where id in
(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23)
</code></pre><p>Now you start seeing GC pauses and heap pressure that leads to overall slower performance, your queries are coming back in what happened?</p>
<p>Imagine the contrived scenario where we have a partition key with the values A,B,C with 9 nodes and a replication factor of 3. When I send in my query that looks like SELECT * FROM mykeyspace.mytable WHERE id IN (‘A’,’B’,C’) the coordinator has to do something like:</p>
<p>in query</p>
<p>In practical terms this means you’re waiting on this single coordinator node to give you a response, it’s keeping all those queries and their responses in the heap, and if one of those queries fails, or the coordinator fails, you have to retry the whole thing.</p>
<p>failed in query</p>
<p>This means a dead coordinator node means the entire query result is gone. Instead of trying to approach this like a relational database let’s embrace the distributed nature of Cassandra and send queries directly to the nodes that can get the best fastest answer.</p>
<p>In Java</p>
<pre><code>PreparedStatement statement = session.prepare(
  &quot;SELECT * FROM tester.users where id = ?&quot;);
List&lt;ResultSetFuture&gt; futures = new ArrayList&lt;&gt;();
for (int i = 1; i &lt; 4; i++) {
 ResultSetFuture resultSetFuture = session.executeAsync(statement.bind(i));
 futures.add(resultSetFuture);
}
List&lt;String&gt; results = new ArrayList&lt;&gt;();
for (ResultSetFuture future : futures){
 ResultSet rows = future.getUninterruptibly();
 Row row = rows.one();
 results.add(row.getString(&quot;name&quot;));
}
return results;
</code></pre><p>In C#</p>
<pre><code>PreparedStatement statement = session.Prepare(&quot;SELECT * FROM tester.users where id = ?&quot;);
List&lt;String&gt; names = new List&lt;String&gt;();
for (int i = 1; i &lt; 4; i++)
{
  var resultSetFuture = session.ExecuteAsync(statement.Bind(i));
  resultSetFuture.ContinueWith(t =&gt;
                        {
                            var result = t.Result.First();
                            var name = result.GetValue&lt;String&gt;(&quot;name&quot;);
                            names.Add(name);
                        });
  resultSetFuture.Wait();

}
return names;
</code></pre><p>Now doing a retry requires only one small fast query, you’ve eliminated the single point of failure.</p>
<p>enter image description here</p>
<p>With separate queries you get no single point of failure, faster reads, less pressure on the coordinator node, and better performance semantics when you have a nodes failing. It truly embraces the distributed nature of Cassandra.</p>
<p>The “in” keyword has it’s place such as when querying INSIDE of a partition, but by and large it’s something I wish wasn’t doable across partitions, I fixed a good dozen performance problems with it so far, and I’ve yet to see it be faster than separate queries plus async.</p>
<p>A note about distributed thinking</p>
<p>This and my ‘no batch’ blog post really drive a bigger discussion about distributed thinking. Most things that don’t really work as well in a distributed database as people think they should, bulk loading via batch, in queries, and ‘rollbacks’ are left over vestiges from a single machine thinking.</p>
<p>This highly consistent single machine world is easy to reason about, but it doesn’t scale easily, and has single points of failure, and when you do make the tradeoffs needed to scale, you find features like “in” queries don’t scale unless they happen to be all be on the same machine (like Cassandra). You’ll find when you try and scale highly consistent single machine technologies via sharding you run into the same problem set as we have with distributed databases, only without appropriate tools.</p>
<p>So embrace continuous availability, multiple replicas, and leave behind yesterday’s approaches.</p>
<h6 id="Related-Articles"><a href="#Related-Articles" class="headerlink" title="Related Articles:"></a>Related Articles:</h6><p>Cassandra: Batch Loading Without the Batch — The Nuanced Edition<br>CASSANDRA LOCAL_QUORUM SHOULD STAY LOCAL<br>Reflection Scala-2.10 and Spark weird errors when saving to Cassandra<br>Logging The Generated CQL from the Spark Cassandra Connector<br>Don’t use TextField for your unique key in Solr</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/12/redis-solution-Is-loading-the-dataset-in-memory/" itemprop="url">
                  Error -->> -LOADING Redis is loading the dataset in memory
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-12T11:09:03+08:00" content="2016-07-12">
              2016-07-12
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/12/redis-solution-Is-loading-the-dataset-in-memory/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/12/redis-solution-Is-loading-the-dataset-in-memory/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Redis单独部署，一主一从，启动后程序连接报错，查看redis server日志，同样有错</p>
<pre><code>➜  shells tail -f /data/apps/log/redis/redis-slave.log 
7201:S 12 Jul 11:05:48.164 * Non blocking connect for SYNC fired the event.
7201:S 12 Jul 11:05:48.260 # Error reply to PING from master: &apos;-LOADING Redis is loading the dataset in memory&apos;
7201:S 12 Jul 11:05:49.197 * Connecting to MASTER 127.0.0.1:16379
7201:S 12 Jul 11:05:49.197 * MASTER &lt;-&gt; SLAVE sync started
7201:S 12 Jul 11:05:49.198 * Non blocking connect for SYNC fired the event.
7201:S 12 Jul 11:05:49.245 # Error reply to PING from master: &apos;-LOADING Redis is loading the dataset in memory&apos;
7201:S 12 Jul 11:05:50.230 * Connecting to MASTER 127.0.0.1:16379
7201:S 12 Jul 11:05:50.230 * MASTER &lt;-&gt; SLAVE sync started
7201:S 12 Jul 11:05:50.231 * Non blocking connect for SYNC fired the event.
7201:S 12 Jul 11:05:50.233 # Error reply to PING from master: &apos;-LOADING Redis is loading the dataset in memory&apos;
7201:S 12 Jul 11:05:51.270 * Connecting to MASTER 127.0.0.1:16379
7201:S 12 Jul 11:05:51.270 * MASTER &lt;-&gt; SLAVE sync started
7201:S 12 Jul 11:05:51.271 * Non blocking connect for SYNC fired the event.
7201:S 12 Jul 11:05:51.277 # Error reply to PING from master: &apos;-LOADING Redis is loading the dataset in memory&apos;
^C
➜  shells tail -f /data/apps/log/redis/redis-master.log
7205:M 12 Jul 11:05:46.877 * DB saved on disk
7205:M 12 Jul 11:05:46.878 * DB saved on disk
7205:M 12 Jul 11:05:46.878 * DB saved on disk
7205:M 12 Jul 11:05:46.882 * DB saved on disk
7205:M 12 Jul 11:05:47.035 * DB saved on disk
7205:M 12 Jul 11:05:47.036 * DB saved on disk
7205:M 12 Jul 11:05:47.036 * DB saved on disk
</code></pre><p>这是因为swap频繁导致，在master下执行下面的命令即可解决:</p>
<pre><code>➜  shells redis-cli -p 16379
    127.0.0.1:16379&gt; FLUSHDB
    OK
</code></pre><p>再次查看日志:</p>
<pre><code>➜  shells tail -f /data/apps/log/redis/redis-master.log
7205:M 12 Jul 11:07:19.693 * DB saved on disk
7205:M 12 Jul 11:07:19.720 * DB loaded from append only file: 159.006 seconds
7205:M 12 Jul 11:07:19.720 * The server is now ready to accept connections on port 16379
7205:M 12 Jul 11:07:20.525 * Slave 127.0.0.1:16380 asks for synchronization
7205:M 12 Jul 11:07:20.526 * Full resync requested by slave 127.0.0.1:16380
7205:M 12 Jul 11:07:20.526 * Starting BGSAVE for SYNC with target: disk
7205:M 12 Jul 11:07:20.529 * Background saving started by pid 7285
7285:C 12 Jul 11:07:20.533 * DB saved on disk
7205:M 12 Jul 11:07:20.624 * Background saving terminated with success
7205:M 12 Jul 11:07:20.624 * Synchronization with slave 127.0.0.1:16380 succeeded
^C
➜  shells tail -f /data/apps/log/redis/redis-slave.log 
7201:S 12 Jul 11:07:20.627 * MASTER &lt;-&gt; SLAVE sync: Loading DB in memory
7201:S 12 Jul 11:07:20.630 * MASTER &lt;-&gt; SLAVE sync: Finished with success
7201:S 12 Jul 11:07:20.631 * Background append only file rewriting started by pid 7286
7201:S 12 Jul 11:07:20.657 * AOF rewrite child asks to stop sending diffs.
7286:C 12 Jul 11:07:20.657 * Parent agreed to stop sending diffs. Finalizing AOF...
7286:C 12 Jul 11:07:20.657 * Concatenating 0.00 MB of AOF diff received from parent.
7286:C 12 Jul 11:07:20.657 * SYNC append only file rewrite performed
7201:S 12 Jul 11:07:20.730 * Background AOF rewrite terminated with success
7201:S 12 Jul 11:07:20.730 * Residual parent diff successfully flushed to the rewritten AOF (0.00 MB)
7201:S 12 Jul 11:07:20.733 * Background AOF rewrite finished successfully
</code></pre><p>正常，启动程序，redis连接也正常了。</p>
<p>Cool !!</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/09/CQL-DataType-for-Cassandra/" itemprop="url">
                  CQL DataType for Cassandra
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-09T18:29:30+08:00" content="2016-07-09">
              2016-07-09
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/09/CQL-DataType-for-Cassandra/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/09/CQL-DataType-for-Cassandra/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h4 id="CQL-data-types"><a href="#CQL-data-types" class="headerlink" title="CQL data types"></a>CQL data types</h4><p>CQL defines built-in data types for columns. The counter type is unique.</p>
<h6 id="CQL-Type"><a href="#CQL-Type" class="headerlink" title="CQL Type"></a>CQL Type</h6><table>
<thead>
<tr>
<th>CQL Type</th>
<th>Constants</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ascii</td>
<td>strings</td>
<td>US-ASCII character string</td>
</tr>
<tr>
<td>bigint</td>
<td>integers</td>
<td>64-bit signed long</td>
</tr>
<tr>
<td>blob</td>
<td>blobs</td>
<td>Arbitrary bytes (no validation), expressed as hexadecimal</td>
</tr>
<tr>
<td>boolean</td>
<td>booleans</td>
<td>true or false</td>
</tr>
<tr>
<td>counter</td>
<td>integers</td>
<td>Distributed counter value (64-bit long)</td>
</tr>
<tr>
<td>decimal</td>
<td>integers, floats</td>
<td>Variable-precision decimal Java type Note: When dealing with currency, it is a best practice to have a currency class that serializes to and from an int or use the Decimal form.</td>
</tr>
<tr>
<td>double</td>
<td>integers, floats</td>
<td>64-bit IEEE-754 floating point Java type</td>
</tr>
<tr>
<td>float</td>
<td>integers, floats</td>
<td>32-bit IEEE-754 floating point Java type</td>
</tr>
<tr>
<td>frozen</td>
<td>tuples, collections, user-defined types</td>
<td>A frozen value serializes multiple components into a single value. Non-frozen types allow updates to individual fields. Cassandra treats the value of a frozen type as a blob. The entire value must be overwritten.Note: Cassandra 2.1.0 to 2.1.2 requires using frozen for tuples:frozen <tuple <int, tuple<text, double>&gt;&gt; Cassandra 2.1.3+ does not require this keyword for tuples.</td>
</tr>
<tr>
<td>inet</td>
<td>strings</td>
<td>IP address string in IPv4 or IPv6 format, used by the python-cql driver and CQL native protocols</td>
</tr>
<tr>
<td>int</td>
<td>integers</td>
<td>32-bit signed integer</td>
</tr>
<tr>
<td>list</td>
<td>n/a</td>
<td>A collection of one or more ordered elements</td>
</tr>
<tr>
<td>map</td>
<td>n/a</td>
<td>A JSON-style array of literals: { literal : literal, literal : literal … }</td>
</tr>
<tr>
<td>set</td>
<td>n/a</td>
<td>A collection of one or more elements</td>
</tr>
<tr>
<td>text</td>
<td>strings</td>
<td>UTF-8 encoded string</td>
</tr>
<tr>
<td>timestamp</td>
<td>integers, strings</td>
<td>Date plus time, encoded as 8 bytes since epoch</td>
</tr>
<tr>
<td>timeuuid</td>
<td>uuids</td>
<td>Type 1 UUID only</td>
</tr>
<tr>
<td>tuple</td>
<td>n/a</td>
<td>Cassandra 2.1 and later. A group of 2-3 fields.</td>
</tr>
<tr>
<td>uuid</td>
<td>uuids</td>
<td>A UUID in standard UUID format</td>
</tr>
<tr>
<td>varchar</td>
<td>strings</td>
<td>UTF-8 encoded string</td>
</tr>
<tr>
<td>varint</td>
<td>integers</td>
<td>Arbitrary-precision integer Java type </td>
</tr>
</tbody>
</table>
<p>In addition to the CQL types listed in this table, you can use a string containing the name of a JAVA class (a sub-class of AbstractType loadable by Cassandra) as a CQL type. The class name should either be fully qualified or relative to the org.apache.cassandra.db.marshal package.</p>
<p>Enclose ASCII text, timestamp, and inet values in single quotation marks. Enclose names of a keyspace, table, or column in double quotation marks.</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/07/09/CQL-DataType-for-Cassandra/#more" rel="contents">
              閱讀全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/09/Composite-Keys-in-Cassandra/" itemprop="url">
                  Composite Keys in Cassandra
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-09T18:22:45+08:00" content="2016-07-09">
              2016-07-09
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/09/Composite-Keys-in-Cassandra/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/09/Composite-Keys-in-Cassandra/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h4><p>A composite key consists of one or more primary key fields. Each field must be of data type supported by underlying data-store.</p>
<p>In JPA (Java Persistence API), there are two ways of specifying composite keys:</p>
<ol>
<li><p>Composite Primary Key:</p>
<p> @Entity<br> @IdClass(TimelineId.class)<br> public class Timeline {</p>
<pre><code>@Id int userId;
@Id long tweetId;

//Other non-primary key fields
</code></pre><p> }<br> Class TimelineId {</p>
<pre><code>int userId;
long tweetId;
</code></pre><p> }</p>
</li>
<li><p>Embedded Primary Key:</p>
<p> @Entity<br> public class Timeline {</p>
<pre><code>@EmbeddedId TimelineId id;
</code></pre><p> //Other non-primary key fields<br> }</p>
<p> @Embeddable<br> Class TimelineId {</p>
<pre><code>int userId;
long tweetId;
</code></pre><p> }</p>
</li>
</ol>
<p>Above Timeline entity is inspired from famous twissandra example. Starting 1.1 release, Cassandra supports composite keys.</p>
<p>Cassandra Composite Keys in Action<br>Visit this page in order to understand Cassandra Schema in general. In this section I will give you a feel of how composite keys are stored in Cassandra.</p>
<p>Let’s start Cassandra 1.1.x server and run following commands from Cassandra/bin directory:</p>
<h5 id="CQL"><a href="#CQL" class="headerlink" title="CQL:"></a>CQL:</h5><pre><code>./cqlsh -3 localhost 9160

CREATE KEYSPACE twissandra with strategy_class = &apos;SimpleStrategy&apos; and strategy_options:replication_factor=1;

use twissandra;

CREATE TABLE timeline(
    user_id varchar,
    tweet_id varchar,
    tweet_device varchar,
    author varchar,
    body varchar,
    PRIMARY KEY(user_id,tweet_id,tweet_device));

INSERT INTO timeline (user_id, tweet_id, tweet_device, author, body) VALUES (&apos;xamry&apos;, &apos;t1&apos;, &apos;web&apos;, &apos;Amresh&apos;, &apos;Here is my first tweet&apos;);
INSERT INTO timeline (user_id, tweet_id, tweet_device, author, body) VALUES (&apos;xamry&apos;, &apos;t2&apos;, &apos;sms&apos;, &apos;Saurabh&apos;, &apos;Howz life Xamry&apos;);
INSERT INTO timeline (user_id, tweet_id, tweet_device, author, body) VALUES (&apos;mevivs&apos;, &apos;t1&apos;, &apos;iPad&apos;, &apos;Kuldeep&apos;, &apos;You der?&apos;);
INSERT INTO timeline (user_id, tweet_id, tweet_device, author, body) VALUES (&apos;mevivs&apos;, &apos;t2&apos;, &apos;mobile&apos;, &apos;Vivek&apos;, &apos;Yep, I suppose&apos;);

cqlsh:twissandra&gt; select * from timeline;
 user_id | tweet_id | author  | body
---------+----------+---------+------------------------
   xamry |       t1 |  Amresh | Here is my first tweet
   xamry |       t2 | Saurabh |        Howz life Xamry
   mevivs |       t1 | Kuldeep |               You der?
     mevivs |       t2 |   Vivek |         Yep, I suppose

cqlsh:twissandra&gt; SELECT * FROM timeline WHERE user_id=&apos;xamry&apos;;
 user_id | tweet_id | tweet_device | author  | body
---------+----------+--------------+---------+------------------------
   xamry |       t1 |          web |  Amresh | Here is my first tweet
   xamry |       t2 |          sms | Saurabh |        Howz life Xamry

cqlsh:twissandra&gt; select * from timeline where tweet_id = &apos;t1&apos;;
 user_id | tweet_id | tweet_device | author  | body
---------+----------+--------------+---------+------------------------
   xamry |       t1 |          web |  Amresh | Here is my first tweet
  mevivs |       t1 |         iPad | Kuldeep |               You der?

cqlsh:twissandra&gt; select * from timeline where user_id = &apos;xamry&apos; and tweet_id=&apos;t1&apos;;
 user_id | tweet_id | tweet_device | author | body
---------+----------+--------------+--------+------------------------
   xamry |       t1 |          web | Amresh | Here is my first tweet

cqlsh:twissandra&gt; select * from timeline where user_id = &apos;xamry&apos; and author=&apos;Amresh&apos;;
Bad Request: No indexed columns present in by-columns clause with Equal operator

cqlsh:twissandra&gt; select * from timeline where user_id = &apos;xamry&apos; and tweet_device=&apos;web&apos;;
Bad Request: PRIMARY KEY part tweet_device cannot be restricted (preceding part tweet_id is either not restricted or by a non-EQ relation)

cqlsh:twissandra&gt; select * from timeline where user_id = &apos;xamry&apos; and tweet_id = &apos;t1&apos; and tweet_device=&apos;web&apos;;
 user_id | tweet_id | tweet_device | author | body
---------+----------+--------------+--------+------------------------
   xamry |       t1 |          web | Amresh | Here is my first tweet
</code></pre><h5 id="Cassandra-cli"><a href="#Cassandra-cli" class="headerlink" title="Cassandra-cli:"></a>Cassandra-cli:</h5><pre><code>impadmin@impetus-ubuntu:/usr/local/apache-cassandra-1.1.2/bin$ ./cassandra-cli -h localhost -p 9160
Connected to: &quot;Test Cluster&quot; on localhost/9160
Welcome to Cassandra CLI version 1.1.2

Type &apos;help;&apos; or &apos;?&apos; for help.
Type &apos;quit;&apos; or &apos;exit;&apos; to quit.

[default@unknown] use twissandra;
Authenticated to keyspace: twissandra
[default@twissandra] list timeline;
&lt;pre&gt;Using default limit of 100
Using default column limit of 100
-------------------
RowKey: xamry
=&gt; (column=t1:web:author, value=Amresh, timestamp=1343729388951000)
=&gt; (column=t1:web:body, value=Here is my first tweet, timestamp=1343729388951001)
=&gt; (column=t2:sms:author, value=Saurabh, timestamp=1343729388973000)
=&gt; (column=t2:sms:body, value=Howz life Xamry, timestamp=1343729388973001)
-------------------
RowKey: mevivs
=&gt; (column=t1:iPad:author, value=Kuldeep, timestamp=1343729388991000)
=&gt; (column=t1:iPad:body, value=You der?, timestamp=1343729388991001)
=&gt; (column=t2:mobile:author, value=Vivek, timestamp=1343729389941000)
=&gt; (column=t2:mobile:body, value=Yep, I suppose, timestamp=1343729389941001)
</code></pre><h4 id="Observations"><a href="#Observations" class="headerlink" title="Observations"></a>Observations</h4><ol>
<li><p>First part of composite key (user_id) is called “Partition Key”, rest (tweet_id, tweet_device) are remaining keys.</p>
</li>
<li><p>Cassandra stores columns differently when composite keys are used. Partition key becomes row key. Remaining keys are concatenated with each column name  (“:” as separator) to form column names. Column values remain unchanged.</p>
</li>
<li><p>Remaining keys (other than partition keys) are ordered, and it’s not allowed to search on any random column, you have to start with the first one and then you can move to the second one and so on. This is evident from “Bad Request” error.</p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/09/An-introduction-to-Cassandra/" itemprop="url">
                  An introduction to Cassandra
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-09T17:56:37+08:00" content="2016-07-09">
              2016-07-09
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/09/An-introduction-to-Cassandra/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/09/An-introduction-to-Cassandra/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h4 id="NoSQL-Movement"><a href="#NoSQL-Movement" class="headerlink" title="NoSQL Movement"></a>NoSQL Movement</h4><p>To deal with the increase in concurrent users (Big Users) and the amount of data (Big Data), applications and their underlying databases need to scale using one of two choices: scale up or scale out. Scaling up implies a centralized approach that relies on bigger and bigger servers. Scaling out implies a distributed approach that leverages many standard, commodity physical or virtual servers.</p>
<p>Prior to NoSQL databases, the default approach was to scale up. This was dictated by the fundamentally centralized, shared-everything architecture of relational database technology. To support more concurrent users and/or store more data, we need a bigger and bigger server with more CPUs, more memory, and more disk storage to keep all the tables.</p>
<p>NoSQL databases were developed from the ground up to be distributed, scale out databases. They use a cluster of standard, physical or virtual servers to store data and support database operations. To scale, additional servers are joined to the cluster and the data and database operations are spread across the larger cluster.</p>
<p>NoSQL databases provide a much easier, linear approach to database scaling at low cost of commodity servers. If 10,000 new users start using your application, simply add another database server to your cluster. Add ten thousand more users and add another server. There’s no need to modify the application as you scale since the application always sees a single (distributed) database. Since commodity servers are expected to fail from time-to-time, NoSQL databases are built to tolerate and recover from such failure making them highly reliable.</p>
<p>NoSQL database is defined as Next Generation Databases mostly addressing some of the points: being non-relational, distributed, open-source and horizontally scalable</p>
<p>There are around 150 NoSQL systems available at present in the market. Each One comes with its own merits and demerits. This post briefly talks about Cassandra and it’s core features.</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/07/09/An-introduction-to-Cassandra/#more" rel="contents">
              閱讀全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/09/Consistency-Tuning-In-Cassandra/" itemprop="url">
                  Consistency Tuning In Cassandra
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-09T17:53:01+08:00" content="2016-07-09">
              2016-07-09
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/09/Consistency-Tuning-In-Cassandra/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/09/Consistency-Tuning-In-Cassandra/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>According to Brewer’s CAP theorem, it is impossible for any distributed computer system to simultaneously provide all three of Consistency, Availability and Partition Tolerance. You can’t have the three at the same time and get an acceptable latency.</p>
<p> <img src="img/cap.jpg" alt=""></p>
<p>Cassandra values Availability and Partitioning tolerance (AP). Trade-offs between consistency and latency are tunable in Cassandra. You can get strong consistency with Cassandra (with an increased latency).</p>
<p>Cassandra extends the concept of eventual consistency. Eventual consistency implies the storage system guarantees that if no new updates are made to the object, eventually all accesses will return the last updated value.</p>
<p>How does C* know which record in the cluster is the latest one?</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/07/09/Consistency-Tuning-In-Cassandra/#more" rel="contents">
              閱讀全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/08/cassandra-query-using-composite-keys/" itemprop="url">
                  Query using composite keys, other than Row Key in Cassandra
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-08T16:44:09+08:00" content="2016-07-08">
              2016-07-08
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/08/cassandra-query-using-composite-keys/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/08/cassandra-query-using-composite-keys/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>I want to query data filtering by composite keys other than Row Key in CQL3. These are my queries:</p>
<pre><code>CREATE TABLE grades (id int,
  date timestamp,
  subject text,
  status text,
  PRIMARY KEY (id, subject, status, date)
);
</code></pre><p>When I try and access the data,</p>
<pre><code>SELECT * FROM grades where id = 1098; //works fine
SELECT * FROM grades where subject = &apos;English&apos; ALLOW FILTERING; //works fine
SELECT * FROM grades where status = &apos;Active&apos; ALLOW FILTERING; //gives an error
</code></pre><p>Bad Request: PRIMARY KEY part status cannot be restricted (preceding part subject is either not restricted or by a non-EQ relation)<br>Just to experiment, I shuffled the keys around keeping ‘id’ as my Primary Row Key always. I am always ONLY able to query using either the Primary Row key or the second key, considering above example, if I swap subjects and status in Primary Key list, I can then query with status but I get similar error if I try to do by subject or by time.<br>Am I doing something wrong? Can I not query data using any other composite key in CQL3? I’m using Cassandra 1.2.6 and CQL3.</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/07/08/cassandra-query-using-composite-keys/#more" rel="contents">
              閱讀全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/08/cassandra-ALLOW-FILTERING/" itemprop="url">
                  ALLOW FILTERING explained
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-08T15:08:43+08:00" content="2016-07-08">
              2016-07-08
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/08/cassandra-ALLOW-FILTERING/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/08/cassandra-ALLOW-FILTERING/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>While discussing with people at the London C* Summit, I realized that it was not always clear for them why Cassandra requires ALLOW FILTERING for some CQL queries and not for some others.</p>
<p>Why ALLOW FILTERING?</p>
<p>Let’s take for example the following table:</p>
<pre><code>CREATE TABLE blogs (blogId int, 
                    time1 int, 
                    time2 int, 
                    author text, 
                    content text, 
                    PRIMARY KEY(blogId, time1, time2));
</code></pre><p>If you execute the following query:</p>
<pre><code>SELECT * FROM blogs;
</code></pre><p>Cassandra will return you all the data that the table blogs contains.</p>
<p>If you now want only the data at a specified time1, you will naturally add an equal condition on the column time1:</p>
<pre><code>SELECT * FROM blogs WHERE time1 = 1418306451235;
</code></pre><p>In response, you will receive the following error message:</p>
<p>Bad Request: Cannot execute this query as it might involve data filtering and thus may have unpredictable performance. If you want to execute this query despite the performance unpredictability, use ALLOW FILTERING.<br>Cassandra knows that it might not be able to execute the query in an efficient way. It is therefore warning you: “Be careful. Executing this query as such might not be a good idea as it can use a lot of your computing resources”.</p>
<p>The only way Cassandra can execute this query is by retrieving all the rows from the table blogs and then by filtering out the ones which do not have the requested value for the time1 column.</p>
<p>If your table contains for example a 1 million rows and 95% of them have the requested value for the time1 column, the query will still be relatively efficient and you should use ALLOW FILTERING.</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/07/08/cassandra-ALLOW-FILTERING/#more" rel="contents">
              閱讀全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/28/install-nginx-mac/" itemprop="url">
                  Installing Nginx in Mac OS X  With Homebrew
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-06-28T16:00:13+08:00" content="2016-06-28">
              2016-06-28
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/28/install-nginx-mac/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/28/install-nginx-mac/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h5 id="Install-with-brew"><a href="#Install-with-brew" class="headerlink" title="Install with brew"></a>Install with brew</h5><p>Use brew to install the nginx with command:</p>
<p>$ brew install nginx</p>
<p>After install run:<br>$ sudo nginx</p>
<h5 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h5><p>Test it by going to URL: <a href="http://localhost:8080">http://localhost:8080</a></p>
<h5 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h5><p>The default place of nginx.conf on Mac after installing with brew is:<br>/usr/local/etc/nginx/nginx.conf</p>
<p>Changing the default port<br>The nginx default port is 8080, we shall change it to 80. First stop the nginx server if it is running by:</p>
<p>$ sudo nginx -s stop</p>
<p>Then open nginx.conf with:<br>$ vim /usr/local/etc/nginx/nginx.conf</p>
<p>and change the:</p>
<p>/usr/local/etc/nginx/nginx.conf<br>server {<br>    listen       8080;<br>    server_name  localhost;</p>
<pre><code>#access_log  logs/host.access.log  main;

location / {
    root   html;
    index  index.html index.htm;
}
</code></pre><p>to:</p>
<p>/usr/local/etc/nginx/nginx.conf<br>server {<br>    listen       80;<br>    server_name  localhost;</p>
<pre><code>#access_log  logs/host.access.log  main;

location / {
    root   html;
    index  index.html index.htm;
}
</code></pre><p>Save configuration and start nginx by<br>$ sudo nginx</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/06/28/install-nginx-mac/#more" rel="contents">
              閱讀全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="剣の心" />
          <p class="site-author-name" itemprop="name">剣の心</p>
          <p class="site-description motion-element" itemprop="description">この世は、强ければ生き、弱ければし。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">28</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分類</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">標籤</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/lynchlee" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/funnyweilee" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://in.relation.to/strong-liu" title="Strong" target="_blank">Strong</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.liulantao.com" title="Lax" target="_blank">Lax</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://ericliang.info" title="Eric" target="_blank">Eric</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://xieyajie.github.io/" title="Yajie" target="_blank">Yajie</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.weittor.com/" title="Weitter" target="_blank">Weitter</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">剣の心</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"kenshinn"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      
      <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
      <script src="/js/src/hook-duoshuo.js"></script>
    
  





  
  
  

  

  

</body>
</html>
